{% extends 'layouts/base.html' %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<link id="pagestyle_dark" href="{{ ASSETS_ROOT }}/css/table.css" rel="stylesheet" />
{% endblock stylesheets %}

{% block content %}
{% load tags %}
<div class="container-fluid py-4">

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header pb-0">
          <div class="d-flex justify-content-between"> 
            <h6>{{ title }}</h6>
            <div>
              <a class="btn btn-outline-secondary btn-sm" href="/planillas">
                <span class="btn-inner--icon"><i class="fas fa-arrow-left"></i></span>
                <span class="btn-inner--text">Atras</span>
              </a>
              <button class="btn btn-icon btn-3 btn-primary btn-sm" type="button" onclick="imprimirTabla()">
                <span class="btn-inner--icon"><i class="fas fa-print"></i></span>
                <span class="btn-inner--text">Imprimir</span>
              </button>
            </div>
            {% if url_crear %}
            <a href="{{ url_crear }}" title="Agregar {{ segment }}">
              <i class="fa fa-plus-circle" aria-hidden="true"></i>
            </a>
            {% endif %}
          </div>
        </div>
        <div class="card-body p-0 d-flex justify-content-center pb-5">
          <table id="tabla-planilla" width="900">
            <tr>
              <td rowspan="5" colspan="5"><img src="{{ ASSETS_ROOT }}/img/gbv.png" alt="Logo del ministerio de poder popular para la Educacion"
                  width="450"></td>
              <th class="text-10" colspan="21">
                Código del Formato: EMG
              </th>
            </tr>
            <tr>
              <th class="text-10 text-left" colspan="4">I. Año escolar:</th>
              <td contenteditable="true" class="text-10 text-left b-solid-1" colspan="4"></td>
            </tr>
            <tr>
              <th class="text-10 text-left" colspan="5">Tipo de evaluación:</th>
              <td class="text-10 b-solid-1" colspan="6" contenteditable="true">Materia Pendiente</td>
              <th class="text-10 text-right" colspan="3">Mes y Año:</th>
              <td class="text-10 b-solid-1 text-left" colspan="3" contenteditable="true"></td>
            </tr>
            <tr height="10"></tr>
            <tr height="10"></tr>
            <tr>
              <th class="text-10 text-left" colspan="26">II Datos del plantel:</th>
            </tr>
            <tr class="mt-3">
              <th class="text-9 text-left" colspan="1">Codigo del plantel:</th>
              <td contenteditable="true" class="b-solid-1 text-10"></td>
              <th class="text-10 text-right" colspan="1">Nombre:</th>
              <td contenteditable="true" class="b-solid-1 text-10 pl-3" colspan="22"></td>
            </tr>
            <tr class="mt-3">
              <th class="text-10 text-left" colspan="1">Dirección:</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="6"></td>
              <th class="text-10 text-right" colspan="5">Teléfono:</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="10"></td>
            </tr>
            <tr class="mt-3">
              <th class="text-10 text-left" colspan="1">Municipio:</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="2"></td>
              <th class="text-10 text-right">Entidad Federal:</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="4"></td>
              <th class="text-10 text-right" colspan="4">Zona Educativa:</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="12"></td>
            </tr>
            <tr class="mt-3">
              <th class="text-10 text-left" colspan="1">Director(a):</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="3"></td>
              <th class="text-10 text-right" colspan="2">Cédula:</th>
              <td contenteditable="true" class="b-solid-1 text-10" colspan="18"></td>
            </tr>
            <tr>
              <th height="10" colspan="26"></th>
            </tr>
            <tr>
              <th class="text-left solid-1_text-center" colspan="26">III RESUMEN FINAL DEL RENDIMIENTO</th>
            </tr>
            <tr>
              <th class="solid-1_text-center" rowspan="3" colspan="1">Nº</th>
              <th class="solid-1_text-center" rowspan="3" colspan="1">CEDULA DE IDENTIDAD</th>
              <th class="solid-1_text-center" rowspan="1" colspan="15">Calificaciones de las Asignaturas</th>
              <th class="solid-1_text-center" rowspan="1" colspan="4">Programa Aprobados</th>
              <th class="solid-1_text-center" rowspan="3" colspan="3">RESUMEN</th>
            </tr>
            <tr>
              <th class="solid-1_text-center" colspan="1">01</th>
              <th class="solid-1_text-center" colspan="1">02</th>
              <th class="solid-1_text-center" colspan="1">03</th>
              <th class="solid-1_text-center" colspan="1">04</th>
              <th class="solid-1_text-center" colspan="1">05</th>
              <th class="solid-1_text-center" colspan="1">06</th>
              <th class="solid-1_text-center" colspan="1">07</th>
              <th class="solid-1_text-center" colspan="1">08</th>
              <th class="solid-1_text-center" colspan="1">09</th>
              <th class="solid-1_text-center" colspan="1">10</th>
              <th class="solid-1_text-center" colspan="1">11</th>
              <th class="solid-1_text-center" colspan="1">12</th>
              <th class="solid-1_text-center" colspan="1">13</th>
              <th class="solid-1_text-center" colspan="1">14</th>
              <th class="solid-1_text-center" colspan="1">15</th>
              <th class="solid-1_text-center" colspan="4">Educación Trabajo</th>
            </tr>

            <tr>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">*</th>
              <th class="solid-1_text-center" colspan="1">1</th>
              <th class="solid-1_text-center" colspan="1">2</th>
              <th class="solid-1_text-center" colspan="1">3</th>
              <th class="solid-1_text-center" colspan="1">4</th>
            </tr>
            {% for i in rows %}
            <tr>
              <th class="solid-1_text-center"> {{ forloop.counter }}</th>
              <td contenteditable="true" class="solid-1_text-center student-check td-first" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
              <td contenteditable="false" class="solid-1_text-center student-check td-data" colspan="1">*</td>
            </tr>
            {% endfor %}           
            <tr>
              <th class="solid-1_text-center" rowspan="6" colspan="3">
                III. Totales
              </th>
            </tr>

            <tr>
              <th class="solid-1_text-center" colspan="2">
                Inscritos
              </th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" colspan="3" rowspan="2"> TIPO DE EVALUACIÓN:</th>
            </tr>
            
            <tr>
                <th class="solid-1_text-center" colspan="2">
                    Inasistentes
                 </th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
            </tr>

            <tr>
              <th class="solid-1_text-center" colspan="2">
                Aprobados
              </th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" colspan="3" rowspan="2"> MATERIA PENDIENTE:</th>
            </tr>

            <tr>
              <th class="solid-1_text-center" colspan="2">
                Aplazados
              </th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
              <th class="solid-1_text-center" contenteditable="true">0</th>
            </tr>

            <tr>
                <th class="solid-1_text-center" rowspan="1" colspan="26">&nbsp;</th>
            </tr>
            <tr>
                <th class="solid-1_text-center" rowspan="1" colspan="26">&nbsp;</th>
            </tr>
            <tr>
                <th class="solid-1_text-center" rowspan="1" colspan="26">&nbsp;</th>
            </tr>
            
            
            <tr>
              <th class="text-left solid-1_text-center" rowspan="1" colspan="26">VI. Identificación del Curso:</th>
            </tr>

            <tr>
              <th class="solid-1_text-center" rowspan="1" colspan="1">Mención:</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1" contenteditable="true">*</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1">Grado ó Año:</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1" contenteditable="true">*</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1">Sección:</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1" contenteditable="true">*</th>
              <th class="solid-1_text-center" rowspan="1" colspan="7">NRO DE ALUMNOS:</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1" contenteditable="true">*</th>
              <th class="solid-1_text-center" rowspan="1" colspan="7">TOTAL DE ALUMNOS:</th>
              <th class="solid-1_text-center" rowspan="1" colspan="1" contenteditable="true">*</th>
            </tr>

            <tr>
              <th class="solid-1_text-center">N°</th>
              <th class="solid-1_text-center" colspan="1">Apellidos</th>
              <th class="solid-1_text-center" colspan="2">Nombres</th>
              <th class="solid-1_text-center" colspan="12">Lugar de Nacimiento</th>
              <th class="solid-1_text-center" colspan="1">EF</th>
              <th class="solid-1_text-center" colspan="1">SEXO</th>
              <th class="solid-1_text-center" colspan="4">FECHA DE NACIMIENTO</th>
            </tr>

            {% for i in rows %}
            <tr>
                <th class="solid-1_text-center">{{ forloop.counter }}</th>
                <th class="solid-1_text-center" contenteditable="true" colspan="1">*</th>
                <th class="solid-1_text-center" contenteditable="true" colspan="2">*</th>
                <th class="solid-1_text-center" contenteditable="true" colspan="12">*</th>
                <th class="solid-1_text-center" contenteditable="true" colspan="1">*</th>
                <th class="solid-1_text-center" contenteditable="true" colspan="1">*</th>
                <th class="solid-1_text-center" contenteditable="true" colspan="4">*</th>
              </tr>
            {% endfor %}   


            <tr>
                <th class="solid-1_text-center">N°</th>
                <th class="solid-1_text-center" colspan="1">Asignaturas</th>
                <th class="solid-1_text-center" colspan="6">Apellidos y Nombres del Profesor</th>
                <th class="solid-1_text-center" colspan="4">CEDULA DE IDENTIDAD</th>
                <th class="solid-1_text-center" colspan="5">FIRMA</th>
                <th class="solid-1_text-center" colspan="1">SEXO</th>
                <th class="solid-1_text-center" colspan="4">IV. Identidad del Curso:</th>
            </tr>

            {% for i in rows %}
            <tr>
                <th class="solid-1_text-center">{{ forloop.counter }}</th>
                <th class="solid-1_text-center" colspan="1" contenteditable="true" >*</th>
                <th class="solid-1_text-center" colspan="6" contenteditable="true" >*</th>
                <th class="solid-1_text-center" colspan="4" contenteditable="true" >*</th>
                <th class="solid-1_text-center" colspan="5" contenteditable="true" >*</th>
                <th class="solid-1_text-center" colspan="1" contenteditable="true" >*</th>
                <th class="solid-1_text-center" colspan="4" contenteditable="true" >*</th>
              </tr>
            {% endfor %}   

            <tr>
                <th class="text-left solid-1_text-center" colspan="26">IV. Observaciones:</th>
            </tr>


            <!-- <tr>
              <th class="solid-1_text-center" colspan="26" height="10"></th>
            </tr> -->

            <tr>
              <th class="solid-1_text-center" colspan="3">VIII. Fecha de Remision</th>
              <td contenteditable="true" class="solid-1_text-center" colspan="4" rowspan="8">SELLO DE PLANTEL</td>
              <th class="solid-1_text-center" colspan="9">IX. Fecha de recepción</th>
              <td contenteditable="true" class="solid-1_text-center" colspan="6" rowspan="8">SELLO DE ZONA EDUCATIVA</td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3">Director(a)</td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9">Funcionario Receptor</td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3">Apellidos y Nombres:</td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9">Apellidos y Nombres:</td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3" height="10"></td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9"></td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3">Cédula de Identidad:</td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9">Cédula de Identidad:</td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3" height="10"></td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9"></td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3">Firma:</td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9">Firma:</td>
            </tr>
            <tr>
              <td contenteditable="true" class="solid-1_text-center" colspan="3" height="10"></td>
              <td contenteditable="true" class="solid-1_text-center" colspan="9"></td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  
</div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
<script> 
  
  function imprimirTabla() {
      // Guardar el contenido original del cuerpo
      var cuerpoOriginal = document.body.innerHTML;

      // Obtener el contenido de la tabla
      var contenidoTabla = document.getElementById("tabla-planilla").outerHTML;

      // Reemplazar el contenido del cuerpo por el contenido de la tabla
      document.body.innerHTML = contenidoTabla;

      // Imprimir el documento
      window.print();

      // Revertir los cambios en el cuerpo
      document.body.innerHTML = cuerpoOriginal;
  }

  $('#buscar').keyup(function() {
    var params = new URLSearchParams(window.location.search);
    var data = {};
    for (var pair of params.entries()) {
      data[pair[0]] = pair[1];
    }
    data['buscar'] = $('#buscar').val();
    $.ajax({
        url: "{% url segment %}",
        data: data,
        dataType: 'json',
        success: function(data) {
            $('#contenedor-tabla').html(data.table_html);
            //$('#contenedor-paginador').html(data.paginator_html);
        }
    });
  })

  document.addEventListener("DOMContentLoaded", function() {

    const rows = document.querySelectorAll("td.td-first");
    console.log(rows);

    rows.forEach((row)=>{

        row.addEventListener('input',function (e) {
            // verificar si en el td-check hay texto
            const value = e.target.innerHTML; 
            console.log(value)
            if(value != '*'){
                //habilitar los td que se encuentran en el padre con class td-data
                const tr = row.parentNode; // row padre
                const datas = tr.querySelectorAll('td.td-data');
                datas.forEach(cell=>{
                    cell.setAttribute("contenteditable", "true");
                    cell.innerHTML = '';
                })
            }else{
                const tr = row.parentNode; // row padre
                const datas = tr.querySelectorAll('td.td-data');
                datas.forEach(cell=>{
                    cell.setAttribute("contenteditable", "false");
                    cell.innerHTML = '*';
                })
            }
        })

        // console.log(row.querySelector('td'))
    })
            // rows.forEach(row => {
            //     const firstCell = row.querySelector("td");
            //     firstCell.addEventListener("input", function() {
            //         const editableCells = row.querySelectorAll("td.student-check");
            //         console.log(editableCells.length)
            //         if (firstCell.textContent.trim() === "") {
            //             editableCells.forEach(cell => cell.setAttribute("contenteditable", "false"));
            //         } else {
            //             editableCells.forEach(cell => cell.setAttribute("contenteditable", "true"));
            //         }
            //     });
            // });

});

  /*
  $(document).on('click', '.paginador', function(e) {
    e.preventDefault();
    var page = $(this).attr('href').split('page=')[1];
    var params = new URLSearchParams(window.location.search);
    var data = {};
    for (var pair of params.entries()) {
        data[pair[0]] = pair[1];
    }
    data['page'] = page;
    $.ajax({
        url: "{% url segment %}",
        data: data,
        dataType: 'json',
        success: function(data) {
            $('#contenedor-tabla').html(data.table_html);
            //$('#contenedor-paginador').html(data.paginator_html);
        }
    });
  });*/
  
</script>
{% endblock javascripts %}